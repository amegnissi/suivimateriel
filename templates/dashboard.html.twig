{% extends 'baseC.html.twig' %}
{% block css %}
    <style>
        .text-bg-primary {
            color: #fff !important;
            background-color: RGBA(13, 110, 253, 1) !important;
        }
    </style>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
{% endblock %}
{% block title %}Tableau de bord{% endblock %}

{% block breadcrumb %}TABLEAU DE BORD{% endblock %}

{% block content %}
    <section class="content">
        <div class="container-fluid">
            <!-- Small boxes (Stat box) -->
            <div class="row">
                {% set couleurs = ['text-bg-primary','bg-success', 'bg-warning', 'bg-light','bg-lightblue','bg-navy',
                    'bg-dark'] %}
                {% set icon = ['ion-bag','ion-stats-bars', 'ion-person-add','ion-android-cloud-done','ion-upload'] %}
                {% for types in operations %}
                    <div class="col-lg-3 col-6">
                        <!-- small box -->
                        <div class="small-box {{ couleurs[loop.index0] }}">
                            <div class="inner">
                                <p>{{ types.typeoperation }}</p>
                                <h3>{{ types.total }}</h3>


                            </div>
                            <div class="icon">
                                <i class="ion {{ icon[loop.index0] }}"></i>
                            </div>
                            <a href="{{ path('assurances_fin',{'id':types.idtype}) }}" class="small-box-footer">Plus de
                                détails
                                <i
                                        class="fas
                    fa-arrow-circle-right"></i></a>
                        </div>
                    </div>
                {% endfor %}
                {#                <!-- ./col --> #}
                {#                <div class="col-lg-3 col-6"> #}
                {#                    <!-- small box --> #}
                {#                    <div class="small-box bg-success"> #}
                {#                        <div class="inner"> #}
                {#                            <p>VISITE TECHNIQUE</p> #}
                {#                            <h3> #}
                {#                                {{ VISITE | length }} #}
                {#                            </h3> #}


                {#                        </div> #}
                {#                        <div class="icon"> #}
                {#                            <i class="ion ion-stats-bars"></i> #}
                {#                        </div> #}
                {#                        <a href="{{ path('assurances_fin',{'type':'visite-technique'}) }}" class="small-box-footer">Plus #}
                {#                            de détails <i class="fas fa-arrow-circle-right"></i></a> #}
                {#                    </div> #}
                {#                </div> #}
                {#                <!-- ./col --> #}
                {#                <div class="col-lg-3 col-6"> #}
                {#                    <!-- small box --> #}
                {#                    <div class="small-box bg-warning"> #}
                {#                        <div class="inner"> #}
                {#                            <p>ASSURANCE</p> #}
                {#                            <h3> #}
                {#                                {{ ASSURANCE | length }} #}
                {#                            </h3> #}


                {#                        </div> #}
                {#                        <div class="icon"> #}
                {#                            <i class="ion ion-person-add"></i> #}
                {#                        </div> #}
                {#                        <a href="{{ path('assurances_fin',{'type':'assurance'}) }}" class="small-box-footer">Plus de #}
                {#                            détails #}
                {#                            <i class="fas fa-arrow-circle-right"></i></a> #}
                {#                    </div> #}
                {#                </div> #}
                {#                <!-- ./col --> #}
                <div class="col-lg-3 col-6">
                    <!-- small box -->
                    <div class="small-box bg-danger">
                        <div class="inner">
                            <p>Nombre d'affectations</p>
                            <h3>{{ totalAffectations }}</h3>
                        </div>
                        <div class="icon">
                            <i class="ion ion-pie-graph"></i>
                        </div>
                        <a href="{{ path('affectations_index') }}" class="small-box-footer">Plus de détails <i class="fas
                    fa-arrow-circle-right"></i></a>
                    </div>
                </div>
                {#                <!-- ./col --> #}
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="card card-primary card-success">
                        <div class="card-header">
                            <h3 class="card-title"> Nombre de materiels par catégorie</h3>
                        </div>
                        <div class="card-body table-responsive">
                            <table class="table table-hover table-sm table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th class="col">Type de materiel</th>
                                    <th class="col">nombre</th>
                                </tr>
                                </thead>
                                {% for typeMateriel in pagination %}
                                    <tr>
                                        <td>{{ typeMateriel.libelle ?: 'N/A' }}</td>
                                        <td>
                                            <span class="badge bg-gradient-success">{{ typeMateriel.materiels|length ?: 0 }}</span>
                                        </td>

                                    </tr>
                                {% else %}
                                    <tr>
                                        <td colspan="4" class="text-center text-secondary">Aucun type de matériel
                                            trouvé.
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="card card-success">
                        <div class="card-header">
                            <h3 class="card-title">Coût de maintenance par mois</h3>

                        </div>
                        <div class="card-body">
                            <div class="chart">
                                <canvas id="barChart"
                                        style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                            </div>
                        </div>
                        <!-- /.card-body -->
                    </div>
                </div>
            </div>

        </div>
    </section>

    {% if operations is not empty %}


        <div class="modal fade bd-example-modal-lg" id="myModal" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Liste des operations Expiréees </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table table-striped">
                            <tr>
                                <th> Materiel</th>
                                <th> Operations</th>
                                <th> Date début</th>
                                <th> Date fin</th>
                                <th> </th>
                            </tr>

                            {% for assurance in operations %}
                                <tr>
                                    <td> {{ assurance.op.materiel.marque.libelle }}
                                        - {{ assurance.op.materiel.immatriculation }} </td>
                                    <td> {{ assurance.op.typeAssurance.libelle ?? '-' | capitalize }}</td>
                                    <td> {{ assurance.op.dateDebut|date('d/m/Y')}}</td>
                                    <td> {{ assurance.op.dateFin|date('d/m/Y') }}</td>

                                    <td>
                                        <span class="badge bg-danger text-white">⏳ Expirée</span>
                                    </td>
                                    <td>
                                        <a  href="{{ path('assurances_renew', {'id': assurance.op.id}) }}" class="btn
                                        btn-primary btn-sm"
                                            title="Renouveler">
                                            <i class="fas fa-reply"></i>
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

{% endblock %}
{% block javascript %}
<script src="{{ asset('adminlte/plugins/chart.js/Chart.min.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>

<script>

  $(function () {

      var areaChartData = {
      labels  : {{ labels|raw }},
      datasets: [{
                label: 'Coût Maintenance (CFA)',
                data: {{ values|raw }},
                pointStrokeColor    : 'rgba(60,141,188,1)',
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                pointHighlightStroke: 'rgba(60,141,188,1)',
                pointRadius          : false,
                borderWidth: 1
            }]
    }
        var barChartCanvas = $('#barChart').get(0).getContext('2d')
    var barChartData = $.extend(true, {}, areaChartData)
   // var temp0 = areaChartData.datasets[0]
    // var temp1 = areaChartData.datasets[1]
    // barChartData.datasets[0] = temp1
  //  barChartData.datasets[1] = temp0

    var barChartOptions = {
      responsive              : true,
      maintainAspectRatio     : false,
      datasetFill             : false
    }
     new Chart(barChartCanvas, {
      type: 'bar',
      data: barChartData,
      options: barChartOptions
    })

    })
 </script>
 {% if operations is not empty %}
    <script>
  $(document).ready(function() {

    $('#myModal').modal('show');
  });

</script>
{% endif %}
{% endblock %}
{% block scripts %}
    <script src="{{ asset('cuba/assets/js/clock.js') }}"></script>
    <script src="{{ asset('cuba/assets/js/chart/apex-chart/apex-chart.js') }}"></script>
    <script src="{{ asset('cuba/assets/js/chart/apex-chart/stock-prices.js') }}"></script>
    <script src="{{ asset('cuba/assets/js/chart/apex-chart/moment.min.js') }}"></script>
    <script src="{{ asset('cuba/assets/js/notify/bootstrap-notify.min.js') }}"></script>
    <script src="{{ asset('cuba/assets/js/dashboard/default.js') }}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>

        // Comma/Separator counter
        (function () {
            const counters = document.querySelectorAll (".counter");
            const speed = 70;

            counters.forEach ((counter) => {
                const updateCount = () => {
                    const target = parseInt (counter.getAttribute ("data-target"));
                    const count = parseInt (counter.innerText.replace (/,/g, "")); // Remove commas from displayed count

                    const increment = Math.trunc (target / speed);

                    if (count < target) {
                        let updatedCount = count + increment;

                        // Format the number with commas for lakh and crore
                        updatedCount = updatedCount.toLocaleString ("en-IN");

                        counter.innerText = updatedCount;
                        setTimeout (updateCount, 1);
                    } else {
                        // Update counter.innerText with formatted target value
                        counter.innerText = target.toLocaleString ("en-IN");
                    }
                };

                updateCount ();
            });
        }) ();
    </script>
    {#    <script src="{{ asset('cuba/assets/js/notify/index.js') }}"></script> #}
    {#    <script src="{{ asset('cuba/assets/js/typeahead/handlebars.js') }}"></script> #}
    {#    <script src="{{ asset('cuba/assets/js/typeahead/typeahead.bundle.js') }}"></script> #}
    {#    <script src="{{ asset('cuba/assets/js/typeahead/typeahead.custom.js') }}"></script> #}
    {#    <script src="{{ asset('cuba/assets/js/typeahead-search/handlebars.js') }}"></script> #}
    {#    <script src="{{ asset('cuba/assets/js/typeahead-search/typeahead-custom.js') }}"></script> #}
    {#    <script src="{{ asset('cuba/assets/js/height-equal.js') }}"></script> #}
    <script src="{{ asset('cuba/assets/js/animation/wow/wow.min.js') }}"></script>
{% endblock %}
