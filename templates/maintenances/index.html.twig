{% extends 'base_table.html.twig' %}

{% block title %}Maintenances{% endblock %}

{% block breadcrumb %}Maintenances{% endblock %}
{% block  breadcrumb_item %}Maintenances{% endblock %}
{% block  breadcrumb_t %} Gestion des Maintenances{% endblock %}
{% block table_titre %}Liste des Maintenances{% endblock %}
 {% block btntitle %}Ajouter une Maintenance{% endblock %}
{% block btnpath %}{{ path('maintenances_create') }}{% endblock %}
{% block tableContent %}
<thead>
<tr>
    <th class="col">N°</th>
    <th class="col">Matériel</th>
    <th class="col">Type</th>
    <th class="col">Date d'Intervention</th>
    <th class="col">Km Actuel</th>
    <th class="col">Km Prochain</th>
    <th class="col">Statut</th>
    <th class="col">Actions</th>
</thead>
<tbody>
{% for maintenance in pagination %}
    <tr>
        <td class="align-middle text-center text-xs font-weight-bold">{{ loop.index }}</td>
        <td class="align-middle">
            <div class="d-flex flex-column justify-content-center">
                <h6 class="mb-0 text-sm">{{ maintenance.materiel.marque.libelle }} - {{ maintenance.materiel.immatriculation }}</h6>
            </div>
        </td>
        <td class="align-middle text-xs font-weight-bold">{{ maintenance.typeMaintenance }}</td>
        <td class="align-middle text-center text-xs font-weight-bold">
            {{ maintenance.dateIntervention|date('d-m-Y') }}
        </td>
        <td class="align-middle text-center text-xs font-weight-bold">
            {{ maintenance.kilometrageActuel ? maintenance.kilometrageActuel|number_format(0, ',', ' ') ~ ' km' : '-' }}
        </td>
        <td class="align-middle text-center text-xs font-weight-bold">
            {{ maintenance.kilometragePrevisionnel ? maintenance.kilometragePrevisionnel|number_format(0, ',', ' ') ~ ' km' : '-' }}
        </td>
        <td class="align-middle text-center">
            {% if maintenance.statut == 0 %}
                <span class="badge bg-warning text-dark">⏳ En cours</span>
            {% else %}
                <span class="badge bg-success">✅ Terminé</span>
            {% endif %}
        </td>
        <td class="align-middle text-center">
            <div class="common-align gap-2 justify-content-start">
                <a href="{{ path('maintenances_show', {'id': maintenance.id}) }}"
                   title="Plus de details">
                    <i class="fa fa-eye"></i>
                </a>
            {% if maintenance.statut == 0 %}
                <form action="{{ path('maintenances_finish', {'id': maintenance.id}) }}" method="post" class="d-inline">
                    <input type="hidden" name="_token" value="{{ csrf_token('finish' ~ maintenance.id) }}">
                    <a type="submit" onclick="return confirm('Confirmer la fin de ' +
                     'cette maintenance ?');">
                        <i class="fa fa-trash"></i>
                    </a>
                </form>
            {% endif %}
            </div>
        </td>
    </tr>
{% else %}
    <tr>
        <td colspan="8" class="text-center text-secondary">Aucune maintenance trouvée.</td>
    </tr>
{% endfor %}
</tbody>
{% endblock %}
{% block pagination %}

    <!-- Pagination -->
    {% if pagination.getTotalItemCount() > 10 %}
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
                {% if pagination.currentPageNumber > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="{{ path('employes_index', {'page': pagination.currentPageNumber - 1}) }}">
                            <span class="material-symbols-rounded">keyboard_arrow_left</span>
                        </a>
                    </li>
                {% endif %}

                {% for page in 1..pagination.pageCount %}
                    <li class="page-item {% if page == pagination.currentPageNumber %}active{% endif %}">
                        <a class="page-link" href="{{ path('employes_index', {'page': page}) }}">{{ page }}</a>
                    </li>
                {% endfor %}

                {% if pagination.currentPageNumber < pagination.pageCount %}
                    <li class="page-item">
                        <a class="page-link" href="{{ path('employes_index', {'page': pagination.currentPageNumber + 1}) }}">
                            <span class="material-symbols-rounded">keyboard_arrow_right</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
{% endblock %}

